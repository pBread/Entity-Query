import t from"lodash.difference";import n from"lodash.intersection";import e from"lodash.isplainobject";import r from"lodash.mergewith";function i(){return(i=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)}const o=Symbol(),c=new WeakMap;function u(u,a=o,d){if(a===o)return Object.keys(u);const y=c.get(u)||c.set(u,(h=u,Object.values(h).flatMap(t=>function(t){return function t(n,r){let i=function(t,n){if(null==t)return{};var e,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n.indexOf(e=o[r])>=0||(i[e]=t[e]);return i}(n,["id"]);return Object.entries(i).flatMap(([n,i])=>e(i)?t(i,f(n,r)):f(`${n}__.${i}`,r))}(t).map(n=>function(t,n){return n.reduceRight((e,r,i)=>n.length-1<=i?{[r]:t}:{[r]:e},{})}([t.id],n.split("__.")))}(t)).reduce((t,n)=>r(t,n,(t,n)=>{if(Array.isArray(t))return t.concat(n)}),{}))).get(u);var h;const m=(Array.isArray(a)?a:[a]).map(t=>function(t,r){return n(...function t(n,r){return Object.keys(n).flatMap(i=>e(n[i])?t(n[i],f(i,r)):{[f(i,r)]:n[i]})}(r).map(n=>function t(n,e,r){if(!e.length)return s(r)?l(n,p(r)).map(t=>n[t]).flat():n[""+r];const[o,...c]=e,u=s(o)?l(n,p(o)).reduce((t,e)=>i({},t,n[e]||{}),{}):n[o];return u?t(u,c,r):[]}(t,Object.keys(n)[0].split("__."),Object.values(n)[0])))}(y,t));switch(d.conditions){case"all":return n(...m);case"any":return[...new Set(...m)];case"diff":return m.length>=2?t(m[0],...m.slice(1)):[];case"none":return t(Object.keys(u),...m);default:throw Error("Invalid Query Conditon: "+d.conditions)}}function a(t){return{conditions:null==t?void 0:t.conditions}}function s(t){try{return"string"==typeof t&&!!p(t)}catch(t){return!1}}function f(t,n=o){return n===o?""+t:`${n}__.${t}`}function l(t,n){return Object.keys(t).filter(t=>n.test(t))}function p(t){const n=t.slice(1,t.lastIndexOf("/")),e=t.slice(t.lastIndexOf("/")+1);return new RegExp(n,e)}export default function(t){return{filter:(n,e)=>u(t,n,a(e)).map(n=>t[n]),search:(n,e)=>u(t,n,a(e))}}
//# sourceMappingURL=index.modern.js.map
